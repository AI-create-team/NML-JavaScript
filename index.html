<html lang="ja">
  <head>
    <title>NNML</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>
  <body>

    <script type="text/javascript">
    var checkBlockquotes, checkBold, checkItalic, checkLine, checkLink, checkNewPage, checkPunctuationNumber, checkPunctuationSymbol, checkReturn, checkRuby, checkSharp, checkSpace, checkStrikethrough;

    var NML = (function() {
      function NML(text1) {
        this.text = text1;
      }

      NML.prototype.to = function(t) {
        var body, s;
        switch (t) {
          case "html":
            s = '';
            body = this.text.split('\n');
            body.forEach(function(text1) {
              this.text = text1;
              return s = s + checkLine(this.text) + '\n';
            });
            return '<div class="page"><div>' + s + '</div></div>';
          case "plain":
            return "PLAIN";
          default:
            return "Error!";
        }
      };

      return NML;

    })();

    checkLine = function(line) {
      line = checkSpace(line);
      line = checkReturn(line);
      line = checkRuby(line);
      line = checkNewPage(line);
      line = checkSharp(line);
      line = checkStrikethrough(line);
      line = checkItalic(line);
      line = checkBold(line);
      line = checkBlockquotes(line);
      line = checkLink(line);
      line = checkPunctuationNumber(line);
      line = checkPunctuationSymbol(line);
      return line;
    };

    checkSpace = function(line) {
      if (line.match(/^[ \s]/)) {
        line = '<p>' + line + '</p>';
      }
      return line;
    };

    checkReturn = function(line) {
      if (line === '') {
        line = '</div><div>';
      }
      return line;
    };

    checkRuby = function(line) {
      var moji, myArray, myRe, ruby, text;
      myRe = /[\||].*?[\((].*?[\))]/g;
      myArray = void 0;
      while ((myArray = myRe.exec(line)) !== null) {
        text = myArray[0];
        moji = text.match(/[\||].*?[\((]/)[0];
        moji = moji.substring(1, moji.length - 1);
        ruby = text.match(/[\((].*?[\))]/)[0];
        ruby = ruby.substring(1, ruby.length - 1);
        line = line.replace(text, '<ruby>' + moji + '<rt>' + ruby + '</rt></ruby>');
      }
      return line;
    };

    checkNewPage = function(line) {
      if (line.match(/^[-ー==]{3,}$/)) {
        line = '</div></div><div class="page"><div>';
      }
      return line;
    };

    checkSharp = function(line) {
      var count, md;
      md = void 0;
      if ((md = line.match(/^[##]*/)[0]) !== '') {
        count = md.length > 6 ? 6 : md.length;
        line = line.replace(/^[##]*/, '');
        line = '<h' + count + '>' + line + '</h' + count + '>';
      }
      return line;
    };

    checkStrikethrough = function(line) {
      var myArray, myRe, text;
      myRe = /[\~〜]{2}.*?[\~〜]{2}/g;
      myArray = void 0;
      while ((myArray = myRe.exec(line)) !== null) {
        text = myArray[0];
        line = line.replace(text, '<s>' + text.substring(2, text.length - 2) + '</s>');
      }
      return line;
    };

    checkItalic = function(line) {
      var myArray, myRe, text;
      myRe = /[\__**]{1}.*?[\__**]{1}/g;
      myArray = void 0;
      while ((myArray = myRe.exec(line)) !== null) {
        text = myArray[0];
        if (!text.match(/^[\__**]{2}$/)) {
          line = line.replace(text, '<i>' + text.substring(1, text.length - 1) + '</i>');
        }
      }
      return line;
    };

    checkBold = function(line) {
      var myArray, myRe, text;
      myRe = /[\__**]{2}.*?[\__**]{2}/g;
      myArray = void 0;
      while ((myArray = myRe.exec(line)) !== null) {
        text = myArray[0];
        line = line.replace(text, '<b>' + text.substring(2, text.length - 2) + '</b>');
      }
      return line;
    };

    checkBlockquotes = function(line) {
      if (line.match(/^[>>]/)) {
        line = '<blockquote>' + line.substring(1) + '</blockquote>';
      }
      return line;
    };

    checkLink = function(line) {
      var linkText, myArray, myRe, name, text, url;
      myRe = /[!!]*\[.*?\][\((].*?[\))]/g;
      myArray = void 0;
      while ((myArray = myRe.exec(line)) !== null) {
        text = myArray[0];
        if (text.match(/[!!]{1,}\[.*?\][\((].*?[\))]/)) {
          if (text.match(/\".*\"/)) {
            linkText = line.match(/\[.*?\]/)[0];
            url = line.match(/[\((].*?[\"]/)[0].replace(RegExp(' ', 'g'), '');
            name = line.match(/[\"].*?[\"]/)[0];
            linkText = linkText.substring(1, linkText.length - 1);
            url = url.substring(1, url.length - 1);
            name = name.substring(1, name.length - 1);
            line = line.replace(text, '<img src="' + url + '" alt="' + linkText + '" title="' + name + '">');
          } else {
            linkText = line.match(/\[.*?\]/)[0];
            url = line.match(/[\((].*?[\))]/)[0].replace(RegExp(' ', 'g'), '');
            linkText = linkText.substring(1, linkText.length - 1);
            url = url.substring(1, url.length - 1);
            line = line.replace(text, '<img src="' + url + '" alt="' + linkText + '">');
          }
        } else {
          if (text.match(/\".*\"/)) {
            linkText = line.match(/\[.*?\]/)[0];
            url = line.match(/[\((].*?[\"]/)[0].replace(RegExp(' ', 'g'), '');
            name = line.match(/[\"].*?[\"]/)[0];
            linkText = linkText.substring(1, linkText.length - 1);
            url = url.substring(1, url.length - 1);
            name = name.substring(1, name.length - 1);
            line = line.replace(text, '<a href="' + url + '" title="' + name + '">' + linkText + '</a>');
          } else {
            linkText = line.match(/\[.*?\]/)[0];
            url = line.match(/[\((].*?[\))]/)[0].replace(RegExp(' ', 'g'), '');
            linkText = linkText.substring(1, linkText.length - 1);
            url = url.substring(1, url.length - 1);
            line = line.replace(text, '<a href="' + url + '">' + linkText + '</a>');
          }
        }
      }
      return line;
    };

    checkPunctuationNumber = function(line) {
      if (line.match(/^[0-9]+\.$/)) {
        line = '<hr class="number">';
      }
      return line;
    };

    checkPunctuationSymbol = function(line) {
      if (line.match(/^[-*ー*]+\.$/)) {
        line = '<hr class="symbol">';
      }
      return line;
    };

    function convert() {

      var textarea = document.getElementsByTagName('textarea')[0];

      var novel = new NML(textarea.value)
      var output = document.getElementById("output");
      output.innerHTML = novel.to("html");
    }
    </script>

    <textarea name="zxcv" cols="50" rows="10" >#見出し1
##見出し2
###見出し3
####見出し4
#####見出し5
######見出し6

~~打ち消し線~~
__太字__
_斜体_

|振り仮名(ルビ)

>引用

---

形式段落形式段落形式段落形式段落形式段落形式段落形式段落形式段落形式段落形式段落形式段落形式段落形式段落形式段落形式段落形式段落

1.

---.

[Qiita](http://qiita.com)

[Qiita](http://qiita.com "Qiita")

![Qiita](http://qiita.com/icons/favicons/public/apple-touch-icon.png)

![Qiita](http://qiita.com/icons/favicons/public/apple-touch-icon.png "Qiita")</textarea>

    <p>
    <input type="button" value="変換" onclick="convert()">
    <div id="output"></div>
  </body>
</html>
